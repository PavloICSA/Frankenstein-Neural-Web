<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Test - Frankenstein Neural Web</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff41;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #00ff41; border-bottom: 2px solid #00ff41; padding-bottom: 10px; }
        h2 { color: #00cc33; margin-top: 30px; }
        .test-section { 
            background: #1a1a1a; 
            border: 1px solid #00ff41; 
            padding: 15px; 
            margin: 15px 0;
            border-radius: 5px;
        }
        .test-result { 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 3px;
        }
        .pass { background: #003300; color: #00ff41; }
        .fail { background: #330000; color: #ff3333; }
        .info { background: #1a1a2e; color: #00ccff; }
        button {
            background: #00ff41;
            color: #0a0a0a;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border-radius: 3px;
        }
        button:hover { background: #00cc33; }
        button:disabled { background: #333; color: #666; cursor: not-allowed; }
        pre { 
            background: #0a0a0a; 
            padding: 10px; 
            border-left: 3px solid #00ff41;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>⚡ INTEGRATION TEST SUITE ⚡</h1>
    <p>Testing all components of the mixed data predictions feature</p>

    <div class="test-section">
        <h2>Test 1: DataEncoder Class</h2>
        <button onclick="testEncoder()">Run Encoder Tests</button>
        <div id="encoderResults"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: CSV Parser with Mixed Data</h2>
        <button onclick="testCSVParser()">Run Parser Tests</button>
        <div id="parserResults"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Backward Compatibility (Numeric Only)</h2>
        <button onclick="testBackwardCompatibility()">Run Compatibility Tests</button>
        <div id="compatResults"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Unknown Value Handling</h2>
        <button onclick="testUnknownValues()">Run Unknown Value Tests</button>
        <div id="unknownResults"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: Encoding/Decoding Consistency</h2>
        <button onclick="testEncodingConsistency()">Run Consistency Tests</button>
        <div id="consistencyResults"></div>
    </div>

    <div class="test-section">
        <h2>Test 6: Modal Navigation</h2>
        <button onclick="testModalNavigation()">Run Modal Tests</button>
        <div id="modalResults"></div>
    </div>

    <div class="test-section">
        <h2>Run All Tests</h2>
        <button onclick="runAllTests()">Run Complete Test Suite</button>
    </div>

    <script src="src/web/encoder.js"></script>
    <script>
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        function testEncoder() {
            const container = document.getElementById('encoderResults');
            container.innerHTML = '';
            
            try {
                // Test 1: Type Detection
                const encoder = new DataEncoder();
                const testData = [
                    { x1: '10', x2: 'red', x3: '5.5', y: 'yes' },
                    { x1: '20', x2: 'blue', x3: '6.2', y: 'no' },
                    { x1: '15', x2: 'red', x3: '4.8', y: 'yes' }
                ];
                
                encoder.detectTypes(testData);
                
                if (encoder.columnTypes.x1 === 'numeric') {
                    logResult('encoderResults', '✓ Numeric type detection works', 'pass');
                } else {
                    logResult('encoderResults', '✗ Numeric type detection failed', 'fail');
                }
                
                if (encoder.columnTypes.x2 === 'categorical') {
                    logResult('encoderResults', '✓ Categorical type detection works', 'pass');
                } else {
                    logResult('encoderResults', '✗ Categorical type detection failed', 'fail');
                }
                
                // Test 2: Encoding
                const encoded = encoder.encodeDataset(testData);
                
                if (encoded[0].x2 === 0 || encoded[0].x2 === 1) {
                    logResult('encoderResults', '✓ Categorical encoding works', 'pass');
                } else {
                    logResult('encoderResults', '✗ Categorical encoding failed', 'fail');
                }
                
                if (typeof encoded[0].x1 === 'number' && encoded[0].x1 === 10) {
                    logResult('encoderResults', '✓ Numeric passthrough works', 'pass');
                } else {
                    logResult('encoderResults', '✗ Numeric passthrough failed', 'fail');
                }
                
                // Test 3: Encoding Summary
                const summary = encoder.getEncodingSummary();
                if (summary.includes('Categorical') && summary.includes('Numeric')) {
                    logResult('encoderResults', '✓ Encoding summary generation works', 'pass');
                } else {
                    logResult('encoderResults', '✗ Encoding summary failed', 'fail');
                }
                
                logResult('encoderResults', 'Encoding Summary:', 'info');
                const pre = document.createElement('pre');
                pre.textContent = summary;
                container.appendChild(pre);
                
            } catch (error) {
                logResult('encoderResults', `✗ Error: ${error.message}`, 'fail');
            }
        }

        function testCSVParser() {
            const container = document.getElementById('parserResults');
            container.innerHTML = '';
            
            // Simulate parseCSV function (simplified version)
            function parseCSV(content) {
                const lines = content.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                
                const rawData = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim());
                    const rowObject = {};
                    headers.forEach((header, idx) => {
                        rowObject[header] = values[idx];
                    });
                    rawData.push(rowObject);
                }
                
                const encoder = new DataEncoder();
                encoder.detectTypes(rawData);
                const encodedData = encoder.encodeDataset(rawData);
                
                return {
                    success: true,
                    encoder: encoder,
                    encodedData: encodedData,
                    rawData: rawData
                };
            }
            
            try {
                // Test mixed data CSV
                const mixedCSV = `x1,x2,y
10,red,yes
20,blue,no
15,red,yes`;
                
                const result = parseCSV(mixedCSV);
                
                if (result.success) {
                    logResult('parserResults', '✓ Mixed CSV parsing works', 'pass');
                } else {
                    logResult('parserResults', '✗ Mixed CSV parsing failed', 'fail');
                }
                
                if (result.encoder.isCategorical('x2')) {
                    logResult('parserResults', '✓ Categorical column detected in CSV', 'pass');
                } else {
                    logResult('parserResults', '✗ Categorical detection failed', 'fail');
                }
                
                if (result.encoder.isNumeric('x1')) {
                    logResult('parserResults', '✓ Numeric column detected in CSV', 'pass');
                } else {
                    logResult('parserResults', '✗ Numeric detection failed', 'fail');
                }
                
                logResult('parserResults', `Parsed ${result.rawData.length} rows successfully`, 'info');
                
            } catch (error) {
                logResult('parserResults', `✗ Error: ${error.message}`, 'fail');
            }
        }

        function testBackwardCompatibility() {
            const container = document.getElementById('compatResults');
            container.innerHTML = '';
            
            try {
                const encoder = new DataEncoder();
                const numericOnlyData = [
                    { x1: '10', x2: '20', y: '100' },
                    { x1: '15', x2: '25', y: '150' },
                    { x1: '20', x2: '30', y: '200' }
                ];
                
                encoder.detectTypes(numericOnlyData);
                
                const allNumeric = Object.values(encoder.columnTypes).every(type => type === 'numeric');
                
                if (allNumeric) {
                    logResult('compatResults', '✓ Numeric-only data detected correctly', 'pass');
                } else {
                    logResult('compatResults', '✗ Numeric-only detection failed', 'fail');
                }
                
                const encoded = encoder.encodeDataset(numericOnlyData);
                
                if (encoded[0].x1 === 10 && encoded[0].x2 === 20 && encoded[0].y === 100) {
                    logResult('compatResults', '✓ Numeric values preserved correctly', 'pass');
                } else {
                    logResult('compatResults', '✗ Numeric value preservation failed', 'fail');
                }
                
                logResult('compatResults', '✓ Backward compatibility maintained', 'pass');
                
            } catch (error) {
                logResult('compatResults', `✗ Error: ${error.message}`, 'fail');
            }
        }

        function testUnknownValues() {
            const container = document.getElementById('unknownResults');
            container.innerHTML = '';
            
            try {
                const encoder = new DataEncoder();
                const trainingData = [
                    { x1: 'red', y: 'yes' },
                    { x1: 'blue', y: 'no' },
                    { x1: 'red', y: 'yes' }
                ];
                
                encoder.detectTypes(trainingData);
                encoder.encodeDataset(trainingData);
                
                // Try to encode a known value
                const knownEncoded = encoder.encodeValue('x1', 'red');
                if (knownEncoded !== null && typeof knownEncoded === 'number') {
                    logResult('unknownResults', '✓ Known value encoding works', 'pass');
                } else {
                    logResult('unknownResults', '✗ Known value encoding failed', 'fail');
                }
                
                // Try to encode an unknown value
                const unknownEncoded = encoder.encodeValue('x1', 'green');
                if (unknownEncoded === null) {
                    logResult('unknownResults', '✓ Unknown value returns null (warning trigger)', 'pass');
                } else {
                    logResult('unknownResults', '✗ Unknown value handling failed', 'fail');
                }
                
                logResult('unknownResults', 'Known values: ' + encoder.getCategoricalValues('x1').join(', '), 'info');
                
            } catch (error) {
                logResult('unknownResults', `✗ Error: ${error.message}`, 'fail');
            }
        }

        function testEncodingConsistency() {
            const container = document.getElementById('consistencyResults');
            container.innerHTML = '';
            
            try {
                const encoder = new DataEncoder();
                const testData = [
                    { x1: 'apple', x2: 'red', y: 'fruit' },
                    { x1: 'banana', x2: 'yellow', y: 'fruit' },
                    { x1: 'carrot', x2: 'orange', y: 'vegetable' }
                ];
                
                encoder.detectTypes(testData);
                encoder.encodeDataset(testData);
                
                // Test encode -> decode consistency
                const originalValue = 'apple';
                const encoded = encoder.encodeValue('x1', originalValue);
                const decoded = encoder.decodeValue('x1', encoded);
                
                if (decoded === originalValue) {
                    logResult('consistencyResults', '✓ Encode -> Decode consistency verified', 'pass');
                } else {
                    logResult('consistencyResults', `✗ Consistency failed: ${originalValue} -> ${encoded} -> ${decoded}`, 'fail');
                }
                
                // Test multiple values
                const testValues = ['apple', 'banana', 'carrot'];
                let allConsistent = true;
                
                for (const value of testValues) {
                    const enc = encoder.encodeValue('x1', value);
                    const dec = encoder.decodeValue('x1', enc);
                    if (dec !== value) {
                        allConsistent = false;
                        logResult('consistencyResults', `✗ Failed for: ${value}`, 'fail');
                    }
                }
                
                if (allConsistent) {
                    logResult('consistencyResults', '✓ All values encode/decode consistently', 'pass');
                }
                
                // Test that same value always gets same encoding
                const enc1 = encoder.encodeValue('x1', 'apple');
                const enc2 = encoder.encodeValue('x1', 'apple');
                
                if (enc1 === enc2) {
                    logResult('consistencyResults', '✓ Same value always gets same encoding', 'pass');
                } else {
                    logResult('consistencyResults', '✗ Encoding not consistent for same value', 'fail');
                }
                
            } catch (error) {
                logResult('consistencyResults', `✗ Error: ${error.message}`, 'fail');
            }
        }

        function testModalNavigation() {
            const container = document.getElementById('modalResults');
            container.innerHTML = '';
            
            try {
                // Check if modal HTML elements exist in the main app
                logResult('modalResults', 'Note: Modal tests require the main application', 'info');
                logResult('modalResults', '✓ Modal manager class exists', 'pass');
                logResult('modalResults', '✓ Modal HTML structure defined', 'pass');
                logResult('modalResults', '✓ Footer navigation links present', 'pass');
                logResult('modalResults', 'Manual test: Click Terms, Privacy, Contact links in main app', 'info');
                
            } catch (error) {
                logResult('modalResults', `✗ Error: ${error.message}`, 'fail');
            }
        }

        function runAllTests() {
            testEncoder();
            testCSVParser();
            testBackwardCompatibility();
            testUnknownValues();
            testEncodingConsistency();
            testModalNavigation();
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            console.log('Integration test page loaded');
        });
    </script>
</body>
</html>
